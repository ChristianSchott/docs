<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Bullet Ballistics</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation for the BulletBallistics unity asset.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="getting_started.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="environment.html"><strong aria-hidden="true">2.</strong> Environment Provider</a></li><li class="chapter-item expanded "><a href="bullet.html"><strong aria-hidden="true">3.</strong> Visual Bullet Providers</a></li><li class="chapter-item expanded "><a href="impact.html"><strong aria-hidden="true">4.</strong> Impact Handlers</a></li><li class="chapter-item expanded "><a href="material.html"><strong aria-hidden="true">5.</strong> Ballistic Materials</a></li><li class="chapter-item expanded "><a href="settings.html"><strong aria-hidden="true">6.</strong> Ballistic Settings</a></li><li class="chapter-item expanded "><a href="bullet_info.html"><strong aria-hidden="true">7.</strong> Bullet Info</a></li><li class="chapter-item expanded "><a href="wind.html"><strong aria-hidden="true">8.</strong> Wind Provider</a></li><li class="chapter-item expanded "><a href="weapon.html"><strong aria-hidden="true">9.</strong> Weapon</a></li><li class="chapter-item expanded "><a href="zeroing.html"><strong aria-hidden="true">10.</strong> Scope Zeroing Generator</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="contact.html">Contact</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Bullet Ballistics</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>Bullet Ballistics 2</strong> allows you to simulate realistic bullet physics in your games with minimal effort.</p>
<p>Unlike a rigidbody based system, it can handle high velocity projectiles without any problems, while also taking into account physical forces like gravity and air resistance.
Additionally, projectiles can penetrate or ricochet of colliders in the scene realistically, depending on physical properties assigned to the colliders.</p>
<p>The main develop goals for version 2 of the Bullet Ballistics asset pack were:</p>
<ul>
<li>performance 
<ul>
<li>multithreading via unity's job system</li>
<li>reducing runtime GC allocations</li>
<li>reducing draw calls</li>
</ul>
</li>
<li>customizability
<ul>
<li>customizable impact handling</li>
<li>customizable projectile rendering</li>
<li>adjusting simulation parameters</li>
</ul>
</li>
<li>ease of use</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>Check out the included example scene in the <code>Ballistics/Example/</code> folder.</p>
<h2 id="minimal-setup"><a class="header" href="#minimal-setup">Minimal Setup</a></h2>
<ul>
<li>create a <code>Assets/Create/Ballistics/Ballistic Settings</code> object in your project folder</li>
<li>add an empty game object to your scene and attach a <code>Environment Provider</code> component to it
<ul>
<li>assign the <code>Ballistic Settings</code> object you have created before</li>
</ul>
</li>
<li>attach a <code>Weapon</code> component to a weapon in your scene
<ul>
<li>assign a transform at the end of the weapon barrel as the <code>Bullet Spawn Point</code> (z-axis pointing forward)</li>
<li>create a <code>Assets/Create/Ballistics/Bullet Info</code> object in your project folder</li>
<li>assign this <code>Bullet Info</code> object in the <code>Weapon</code> component</li>
</ul>
</li>
<li>calling <code>Shoot()</code> on the <code>Weapon</code> component will fire a bullet (you can use the <code>Simple Weapon Input</code> component, to shoot  when clicking the left mouse button)</li>
</ul>
<p><strong>Note!</strong> As so far no impact handler or visual bullet provider is set up, you will <em>NOT</em> see the bullet or any impacts!</p>
<h2 id="visual-bullet-provider"><a class="header" href="#visual-bullet-provider">Visual Bullet Provider</a></h2>
<p>Bullet Ballistics separates the ballistics simulation from the visual projectiles flying through the scene.
This allows to optimize the rendering when thousands of projectiles are active simultaneously, and allows you to customize the rendering to your needs.</p>
<ul>
<li>create a <code>Assets/Create/Ballistics/Visual Bullet Providers/Pooled Bullet Provider</code> object, and assign a bullet prefab with a <code>Pooled Bullet</code> component attached</li>
<li>assign the new <code>Pooled Bullet Provider</code> object to the <code>Visual Bullet Provider</code> field of your weapon</li>
</ul>
<p>You should now be able to see the bullet prefab when shooting the weapon.</p>
<h2 id="impact-handler"><a class="header" href="#impact-handler">Impact Handler</a></h2>
<p>Similar to the <code>Visual Bullet Provider</code> the <code>Impact Handler</code> allows you to customize what should happen on a projectile impact.</p>
<ul>
<li>create a <code>Assets/Create/Ballistics/Impact Handler/Generic Impact Handler</code> object in your project folder
<ul>
<li>assign the impact handler object to the <code>Global Impact Handler</code> field of your <code>Environment Provider</code> component</li>
</ul>
</li>
<li>enabling <code>Handle Rigidbody Forces</code> should cause rigidbodies to be affected by projectile impacts</li>
<li>adding a audio clip to the <code>Impact Sounds</code> list, will cause an impact sound at any impact of a projectile with the scene</li>
</ul>
<h2 id="ballistic-materials"><a class="header" href="#ballistic-materials">Ballistic Materials</a></h2>
<p>Ballistic Material define how a projectile will behave when interacting with a collider.</p>
<ul>
<li>create a <code>Assets/Create/Ballistic/Ballistic Material</code> object in your project folder
<ul>
<li>a Ballistic Material is a unity <code>Physic Material</code> with an associated <code>Ballistic Material</code> object</li>
<li>you can promote/demote a <code>Physic Material</code> to/from a <code>Ballistic Material</code> by right-clicking the <code>Physic Material</code> and selecting <code>Assets/Create/Ballistics/To BallisticMaterial</code> / <code>Unlink BallisticMaterial</code></li>
</ul>
</li>
<li>assign a Ballistic Material to a collider by setting the <code>Material</code> field of the collider to a <code>Physic Material</code> associated with a <code>Ballistic Material</code> object</li>
<li>by change the properties of the Ballistic Material to alter the bullet interactions</li>
</ul>
<p>For more information on each of these topics check out the following chapters.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-provider"><a class="header" href="#environment-provider">Environment Provider</a></h1>
<p>Each scene using Bullet Ballistics should have a single game object with a <code>Environment Provider</code> component attached.</p>
<p>The <code>Environment Provider</code> configures the ballistic simulation setting for the current scene.
Including:</p>
<ul>
<li>Ballistic Settings</li>
<li>Wind Velocity</li>
<li>Global Impact Handler</li>
<li>Bullet Path Debugging (Editor only)</li>
</ul>
<p>In theory these settings can also be adjusted manually in the static <code>Ballistics.Core</code> class.
The <code>Environment Provider</code> automatically configures the <code>Ballistics.Core</code> on startup/ scene change.</p>
<p>When modifying the <code>Environment Provider</code> properties at runtime, make sure to enable <code>Continuous Environment Update</code> to ensure, the <code>Ballistics.Core</code> is updated too.</p>
<p>The fields of the <code>Environment Provider</code> will be explained further in the respective chapters.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="visual-bullet-provider-1"><a class="header" href="#visual-bullet-provider-1">Visual Bullet Provider</a></h1>
<p>A <code>Visual Bullet Provider</code> is just a scriptable object, with a <code>GetVisualBullet()</code> method, which returns a new <code>IVisualBullet</code>.</p>
<pre><code class="language-C#">public abstract class VisualBulletProviderObject : InitializableScriptableObject
{
    public abstract IVisualBullet GetVisualBullet();
}
</code></pre>
<p>The <code>IVisualBullet</code> interface consists of:</p>
<pre><code class="language-C#">public interface IVisualBullet
{
    void InitializeBullet(in BulletPose pose, in float3 visualOffset);  // start of ballistic simulation
    void UpdateBullet(in BulletPose pose);                              // pose update, each simulation cycle
    void DestroyBullet();                                               // bullet has been destroyed (stopped or timeout)          
}
</code></pre>
<p>The <code>visualOffset</code> argument of <code>InitializeBullet()</code> will be explained further in the chapter about the <a href="./weapon.html">Weapon</a> component.</p>
<p>The <code>Visual Bullet Provider</code> adds a layer of abstraction between the simulation and the rendering.
This allows switching between rendering strategies easily.</p>
<p>For example, the <code>Pooled Bullet Provider</code> uses basic prefab instanciation for rendering the visual bullet (+ pooling instead of destroying bullets, to minimize garbage collection overhead).</p>
<p>Switching the visual bullet of a <code>Weapon</code> to the <code>Tracer Bullet Provider</code> can be done, by simply replacing the <code>Visual Bullet Provider</code> of the <code>Weapon</code> component.
The <code>Tracer Bullet Provider</code> draws bullets, by rendering a trail between the last three bullet positions.
The <code>Tracer Bullet Provider</code> can render bullets very efficiently, as it is able to combine ~10.000 bullets into a single draw call. </p>
<p>With this flexibility it is very easy to create your own <code>Visual Bullet Provider</code>s which fit your game's requirements optimally!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="impact-handler-1"><a class="header" href="#impact-handler-1">Impact Handler</a></h1>
<p>Similar to a <code>Visual Bullet Provider</code> a <code>Impact Handler</code> is also a scriptable object, which adds a layer of abstraction between the ballistic simulation and the rest of your game.</p>
<pre><code class="language-C#">public abstract class ImpactHandlerObject : InitializableScriptableObject, IImpactHandler
{
    public abstract HandledFlags HandleSurfaceInteraction(in SurfaceInteractionInfo impact, HandledFlags flags);
    public abstract HandledFlags HandleImpact(in ImpactInfo impact, HandledFlags flags);
}
</code></pre>
<ul>
<li><code>HandleSurfaceInteraction</code> is called whenever a projectile first enters, ricochets, exits, or stops inside of a collider</li>
<li><code>HandleImpact</code> is called when a projectile penetrates a collider</li>
</ul>
<p>Similar to the <code>Pooled Bullet Provider</code> the <code>Pooled Impact Instantiator</code> instantiates a prefab with an attached <code>Impact Object</code> component at a surface interaction (and pooles the instantiated prefabs).</p>
<p>Alternatively, the <code>Generic Impact Handler</code> provides default handling for rigidbody interactions, a damage system, and audio effects.</p>
<h2 id="chain-of-responsibility"><a class="header" href="#chain-of-responsibility">Chain Of Responsibility</a></h2>
<p>As some bullet interactions might be specific to the bullet, material, or collider, the <code>Impact Handler</code> system is structured hierarchically.</p>
<p>The <code>Bullet Info</code>, <code>Ballistic Material</code>, <code>Environemnt Provider</code>, and collider can each provide an <code>Impact Handler</code>.
When a bullet hits a collider the impact handlers are called (if present) in this order:</p>
<ul>
<li><code>Bullet Info</code> specific <code>Impact Handler</code></li>
<li><code>Ballistic Material</code> specific <code>Impact Handler</code></li>
<li>global impact handler provided by the <code>Environment Provider</code></li>
</ul>
<p>The collider specific <code>Impact Handler</code> is not called by default, as this requires a <code>GetComponent</code> call!
You can query for a collider specific <code>Impact Handler</code> inside any of the above impact handling stages, by trying to get a component inheriting the <code>IImpactHandler</code> interface and calling the specific handler.</p>
<p>When collider specific a <code>Impact Handler</code> is needed globally, you can use a <code>Generic Impact Handler</code> as the global <code>Impact Handler</code>, and enable <code>CheckForPerColliderHandler</code>.</p>
<p>At each step of the <code>Impact Handler</code> chain you receive the <code>HandledFlags</code> of the previous handlers, and can return which flags have been handled by the current handler.
This allows, for example, a bullet impact handler to override the bullet hole prefab of the global impact handler, or a material impact handler to alter the impact sound effect.</p>
<h2 id="impact-info"><a class="header" href="#impact-info">Impact Info</a></h2>
<pre><code class="language-C#">public readonly struct SurfaceInteractionInfo
{
    public enum InteractionType
    {
        STOP,
        ENTER,
        RICOCHET,
        EXIT,
    }
    public readonly InteractionType Type;
    public readonly RaycastHit HitInfo;
    public readonly float3 Velocity;
    public readonly float SpreadAngle;
    public readonly float SpeedFactor;      // percentage of speed lost on ricochet
    public readonly BulletInfo BulletInfo;
    public readonly Weapon Weapon;
}

public readonly struct ImpactInfo
{
    public readonly RaycastHit HitInfo;
    public readonly float3 EntryVelocity;
    public readonly float ImpactDepth;
    public readonly float EnergyLossPerUnit;
    public readonly BulletInfo BulletInfo;
    public readonly Weapon Weapon;
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ballistic-material"><a class="header" href="#ballistic-material">Ballistic Material</a></h1>
<p>A <code>Ballistic Material</code> specifies how a projectile interacts with a collider.</p>
<p>Custom <code>Ballistic Materials</code> can be created by implementing the <code>IBallisticMaterial</code> interface, and associating them with a <code>Physic Material</code> at runtime, by adding them to the <code>BallisticMaterialCache</code>.</p>
<p>However, for must cases it will be sufficient to create a <code>Ballistic Material</code> scriptable object via <code>Assets/Create/Ballistics/Ballistic Material</code>.
These will be associated with a <code>Physic Material</code> automatically.</p>
<pre><code class="language-C#">public interface IBallisticMaterial
{
    MaterialImpact HandleImpact(in float3 velocity, BulletInfo info, in RaycastHit rayHit);
    float GetEnergyLossPerUnit();
    float GetSpreadAngle();
    IImpactHandler GetImpactHandler();
}
</code></pre>
<p>Combining <code>Ballistic Material</code>s with unity's <code>Physic Material</code>s has the advantage that unity directly provides the <code>Physic Material</code> of the hit collider from a raycast query, so no <code>GetComponent</code> call to something like a <em><code>Ballistic Material Provider</code></em> component on the object is required, which would come with a performance impact.</p>
<p>The main method of the <code>IBallisticMaterial</code> interface is <code>HandleImpact</code>.
It provides all the available information about the impact, and the <code>Ballistic Material</code> decides how the projectile should continue, by returning a <code>MaterialImpact</code> struct.</p>
<pre><code class="language-C#">public readonly struct MaterialImpact
{
    public enum Result
    {
        STOP,
        ENTER,
        RICOCHET
    }
    public readonly Result ImpactResult;
    public readonly float SpreadAngle;
    public readonly float SpeedFactor;
}
</code></pre>
<p>The bullet can either be stopped right away, be reflected (ricochet), or penetrate (enter) the collider.
The <code>SpeedFactor</code> is multiplied with the current bullet velocity to result in the new bullet velocity.</p>
<p>The <code>SpreadAngle</code> only applies to <code>Ricochet</code> bullets. 
When a bullet penetrates a collider, the spread is applied on the exit and is determined by the <code>GetSpreadAngle</code> method.</p>
<p>For additional information about the <code>Ballistic Material</code> object fields, please refer to the inspector tooltips.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ballistic-settings"><a class="header" href="#ballistic-settings">Ballistic Settings</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bullet-info"><a class="header" href="#bullet-info">Bullet Info</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wind-provider"><a class="header" href="#wind-provider">Wind Provider</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="weapon"><a class="header" href="#weapon">Weapon</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scope-zeroing-generator"><a class="header" href="#scope-zeroing-generator">Scope Zeroing Generator</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contact"><a class="header" href="#contact">Contact</a></h1>
<p>Any questions or suggestions?</p>
<ul>
<li>Christian Schott</li>
<li>E-Mail: <a href="mailto:mr3d.cs@gmail.com">mr3d.cs@gmail.com</a></li>
<li>YouTube: <a href="https://www.youtube.com/channel/UC2-tdH9kaJTJ36vbzB31fbg">https://www.youtube.com/channel/UC2-tdH9kaJTJ36vbzB31fbg</a></li>
<li>Unity AssetStore: <a href="https://assetstore.unity.com/publishers/16528">https://assetstore.unity.com/publishers/16528</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
